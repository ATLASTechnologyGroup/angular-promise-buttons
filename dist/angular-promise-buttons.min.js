angular.module("angularPromiseButtons",[]),angular.module("angularPromiseButtons").directive("promiseBtn",["angularPromiseButtons","$parse","$timeout",function(a,b,c){"use strict";var d="click",e="ngClick",f="submit",g="ngSubmit";return{restrict:"EA",priority:a.config.priority,scope:{promiseBtn:"=",promiseBtnOptions:"=?"},link:function(h,i,j){function k(a){x.btnLoadingClass&&!x.addClassToCurrentBtnOnly&&a.addClass(x.btnLoadingClass),x.disableBtn&&!x.disableCurrentBtnOnly&&a.attr("disabled","disabled")}function l(a){x.minDuration&&!u||!v||(x.btnLoadingClass&&a.removeClass(x.btnLoadingClass),x.disableBtn&&a.removeAttr("disabled"))}function m(a,b){h.$watch(a,function(a){u=!1,v=!1,x.minDuration&&(t=c(function(){u=!0,l(b)},x.minDuration)),a&&a.then?(k(b),a.finally(function(){v=!0,l(b)})):a&&a.$promise&&(k(b),a.$promise.finally(function(){v=!0,l(b)}))})}function n(a){return a.split(";").map(function(a){return b(a)})}function o(a){a.append(x.spinnerTpl)}function p(a){x.addClassToCurrentBtnOnly&&a.on(d,function(){a.addClass(x.btnLoadingClass)}),x.disableCurrentBtnOnly&&a.on(d,function(){a.attr("disabled","disabled")})}function q(a,b,c){h.$evalAsync(function(){var d=n(j[b]);i.unbind(a),i.bind(a,function(){h.$apply(function(){d.forEach(function(b){var d=b(h.$parent,{$event:a});s||(s=m(function(){return d},c))})})})})}function r(a){for(var b=[],c=a.find("button"),d=0;d<c.length;d++){var e=c[d];"submit"===angular.element(e).attr("type")&&b.push(e)}return angular.element(b)}var s,t,u,v,w=a.config,x=w;if(j.promiseBtn)o(i),p(i),m(function(){return h.promiseBtn},i);else if(j.hasOwnProperty(e))o(i),p(i),q(d,e,i);else if(j.hasOwnProperty(g)){var y=r(i);o(y),p(y),q(f,g,y)}h.$watch("promiseBtnOptions",function(a){angular.isObject(a)&&(x=angular.extend({},w,a))},!0),h.$on("$destroy",function(){c.cancel(t)})}}}]),angular.module("angularPromiseButtons").provider("angularPromiseButtons",function(){"use strict";var a={spinnerTpl:'<span class="btn-spinner"></span>',priority:0,disableBtn:!0,btnLoadingClass:"is-loading",addClassToCurrentBtnOnly:!1,disableCurrentBtnOnly:!1,minDuration:!1,CLICK_EVENT:"click",CLICK_ATTR:"ngClick",SUBMIT_EVENT:"submit",SUBMIT_ATTR:"ngSubmit"};return{extendConfig:function(b){a=angular.extend(a,b)},$get:function(){return{config:a}}}});