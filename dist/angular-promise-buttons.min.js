angular.module("angularPromiseButtons",[]),angular.module("angularPromiseButtons").directive("promiseBtn",["angularPromiseButtons","$compile","$parse","$timeout",function(a,b,c,d){"use strict";var e="click",f="ngClick",g="submit",h="ngSubmit";return{restrict:"EA",priority:a.config.priority,scope:{promiseBtn:"=",promiseBtnOptions:"=?"},link:function(b,i,j){function k(a){B.btnLoadingClass&&!B.addClassToCurrentBtnOnly&&a.addClass(B.btnLoadingClass),B.disableBtn&&!B.disableCurrentBtnOnly&&a.attr("disabled","disabled"),B.btnLoadingHtml&&(a.html(B.btnLoadingHtml),r(a))}function l(a,b,c){n(a);var e=0;return c.handlerFunction&&angular.isFunction(c.handlerFunction)&&c.handlerFunction(),B.onComplete&&angular.isFunction(B.onComplete)&&B.onComplete(),c&&c.resultWaitTime&&c.resultWaitTime>=0&&(e=c.resultWaitTime),e&&m(a,c),z=d(function(){o(a,b,c)},e)}function m(a,b){console.log(b),b&&(b.resultHtml&&a.html(b.resultHtml),b.resultCssClass&&a.addClass(b.resultCssClass))}function n(a){B.btnLoadingClass&&a.removeClass(B.btnLoadingClass)}function o(a,b,c){B.disableBtn&&a.removeAttr("disabled"),b&&a.html()!=b&&a.html(b),c&&c.resultCssClass&&a.removeClass(c.resultCssClass)}function p(a,c){b.$watch(a,function(a){var b;if(x=!1,y=!1,B.minDuration&&(w=d(function(){x=!0,l(c)},B.minDuration)),a&&a.then?b=a:a&&a.$promise&&(b=a.$promise),b){var e=B.defaultHtml||c.html();k(c),b.then(function(){y=!0,console.log("SUCCESS"),l(c,e,B.onSuccessConfig)},function(){y=!0,console.log("ERRO"),l(c,e,B.onErrorConfig)})}})}function q(a){return a.split(";").map(function(a){return c(a)})}function r(a){a.append(B.spinnerTpl)}function s(a){B.addClassToCurrentBtnOnly&&a.on(e,function(){a.addClass(B.btnLoadingClass)}),B.disableCurrentBtnOnly&&a.on(e,function(){a.attr("disabled","disabled")})}function t(a,c,d){b.$evalAsync(function(){var e=q(j[c]);i.unbind(a),i.bind(a,function(){b.$apply(function(){e.forEach(function(c){var e=c(b.$parent,{$event:a});v||(v=p(function(){return e},d))})})})})}function u(a){for(var b=[],c=a.find("button"),d=0;d<c.length;d++){var e=c[d];"submit"===angular.element(e).attr("type")&&b.push(e)}return angular.element(b)}var v,w,x,y,z,A=a.config,B=A;if(j.promiseBtn)r(i),s(i),p(function(){return b.promiseBtn},i);else if(j.hasOwnProperty(f))r(i),s(i),t(e,f,i);else if(j.hasOwnProperty(h)){var C=u(i);r(C),s(C),t(g,h,C)}b.$watch("promiseBtnOptions",function(a){angular.isObject(a)&&(B=angular.extend({},A,a))},!0),b.$on("$destroy",function(){d.cancel(w),d.cancel(z)})}}}]),angular.module("angularPromiseButtons").provider("angularPromiseButtons",function(){"use strict";var a={spinnerTpl:'<span class="btn-spinner"></span>',priority:0,disableBtn:!0,btnLoadingClass:"is-loading",addClassToCurrentBtnOnly:!1,disableCurrentBtnOnly:!1,minDuration:!1,btnLoadingHtml:null,defaultHtml:null,onComplete:null,onSuccessConfig:{handlerFunction:null,resultWaitTime:1e3,resultHtml:"Success",resultCssClass:"is-success"},onErrorConfig:{handlerFunction:null,resultWaitTime:1e3,resultHtml:"Error",resultCssClass:"is-error"},CLICK_EVENT:"click",CLICK_ATTR:"ngClick",SUBMIT_EVENT:"submit",SUBMIT_ATTR:"ngSubmit"};return{extendConfig:function(b){a=angular.extend(a,b)},$get:function(){return{config:a}}}});