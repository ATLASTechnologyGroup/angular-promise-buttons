angular.module("angularPromiseButtons",[]),angular.module("angularPromiseButtons").directive("promiseBtn",["angularPromiseButtons","$parse","$timeout","$q",function(a,b,c,d){"use strict";var e="click",f="ngClick",g="submit",h="ngSubmit";return{restrict:"EA",priority:a.config.priority,scope:{promiseBtn:"=",promiseBtnOptions:"=?"},link:function(i,j,k){function l(a){z.btnLoadingClass&&!z.addClassToCurrentBtnOnly&&a.addClass(z.btnLoadingClass),z.disableBtn&&!z.disableCurrentBtnOnly&&a.attr("disabled","disabled")}function m(a){z.minDuration&&!w||!x||(z.btnLoadingClass&&a.removeClass(z.btnLoadingClass),z.disableBtn&&a.removeAttr("disabled"))}function n(a,b){if(z.btnLoadingClass){a.removeClass(z.btnLoadingClass);var d=b?z.btnLoadingComplete:z.btnLoadingFail;a.addClass(d),c(function(){a.removeClass(d)},z.btnLoadingCompleteReset)}}function o(a,b){i.$watch(a,function(a){function e(a){return h=!a||!a.IsError,a}function f(a){return h=!1,d.reject(a)}function g(){x=!0,n(b,h),m(b)}w=!1,x=!1;var h=!1;z.minDuration&&(v=c(function(){w=!0,m(b)},z.minDuration)),a&&a.then?(l(b),a.then(e,f).finally(g)):a&&a.$promise&&(l(b),a.$promise.then(e,f).finally(g))})}function p(a){return a.split(";").map(function(a){return b(a)})}function q(a){0==a.find(".btn-spinner").length&&(i.prepend?a.prepend(z.spinnerTpl):a.append(z.spinnerTpl))}function r(a){z.addClassToCurrentBtnOnly&&a.on(e,function(){a.addClass(z.btnLoadingClass)}),z.disableCurrentBtnOnly&&a.on(e,function(){a.attr("disabled","disabled")})}function s(a,b,c){i.$evalAsync(function(){var d=p(k[b]);j.unbind(a),j.bind(a,function(){i.$apply(function(){d.forEach(function(b){var d=b(i.$parent,{$event:a});u||(u=o(function(){return d},c))})})})})}function t(a){for(var b=[],c=a.find("button"),d=0;d<c.length;d++){var e=c[d];"submit"===angular.element(e).attr("type")&&b.push(e)}return angular.element(b)}var u,v,w,x,y=a.config,z=y;if(k.promiseBtn)q(j),r(j),o(function(){return i.promiseBtn},j);else if(k.hasOwnProperty(f))q(j),r(j),s(e,f,j);else if(k.hasOwnProperty(h)){var A=t(j);q(A),r(A),s(g,h,A)}i.$watch("promiseBtnOptions",function(a){angular.isObject(a)&&(z=angular.extend({},y,a))},!0),i.$on("$destroy",function(){c.cancel(v)})}}}]),angular.module("angularPromiseButtons").provider("angularPromiseButtons",function(){"use strict";var a={spinnerTpl:'<span class="btn-spinner"></span>',priority:0,disableBtn:!0,btnLoadingClass:"is-loading",btnLoadingComplete:"completed-loading",btnLoadingFail:"fail-loading",btnLoadingCompleteReset:3e3,prepend:!1,addClassToCurrentBtnOnly:!1,disableCurrentBtnOnly:!1,minDuration:!1,CLICK_EVENT:"click",CLICK_ATTR:"ngClick",SUBMIT_EVENT:"submit",SUBMIT_ATTR:"ngSubmit"};return{extendConfig:function(b){a=angular.extend(a,b)},$get:function(){return{config:a}}}});